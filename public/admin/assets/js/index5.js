var D=Object.defineProperty;var z=(n,e,c)=>e in n?D(n,e,{enumerable:!0,configurable:!0,writable:!0,value:c}):n[e]=c;var y=(n,e,c)=>z(n,typeof e!="symbol"?e+"":e,c);import{q as K,a as H,r as G,s as J,g as Q,t as x}from"./element-plus.js";import{c as T,o as j,a as o,V as M,r as w,n as W,U as a,ay as X,O as $,K as f,ae as Y,a2 as b,u as Z,H as ee}from"./@vue.js";import{u as te,a as se}from"./vue-router.js";import{M as oe}from"./vue3-puzzle-vcode.js";import{_ as k,A as v,h as l,u as re}from"./index.js";import{d as ae,c as le}from"./login_log.js";import{a as I}from"./js-cookie.js";import"./dayjs.js";import"./ace-builds.js";import"./@element-plus.js";import"./lodash-es.js";import"./@popperjs.js";import"./async-validator.js";import"./@ctrl.js";import"./memoize-one.js";import"./normalize-wheel-es.js";import"./pinia.js";import"./pinia-plugin-persist.js";import"./axios.js";import"./nprogress.js";import"./@fingerprintjs.js";import"./tslib.js";/* empty css     */const ne={},ce={xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",width:"64px",height:"64px",viewBox:"0 0 64 64","xml:space":"preserve"};function ie(n,e){return j(),T("svg",ce,[...e[0]||(e[0]=[o("g",null,[o("path",{"fill-rule":"evenodd",fill:"#1A85F8",d:"M45.354,29.9C45.354,17.983,32.5,9,32.5,9C18.529,20.55,20.206,30.45,20.206,30.45\n			C12.289,24.675,4,27.15,4,27.15s2.515,4.125,3.912,7.149c1.397,3.025,2.515,6.05,6.147,10.45c3.633,4.4,8.941,6.6,8.941,6.6\n			s-2.235-1.466-2.235-5.5c0-5.041,5.588-6.05,5.588-6.05c-0.932-0.825-1.677-2.108-1.677-4.399c0-2.292,2.049-4.309,4.471-6.051\n			c2.422-1.741,3.912-3.85,3.912-3.85c0,0.458,2.049,3.208,3.354,4.4c1.304,1.191,4.471,2.566,4.471,5.5\n			c0,2.933-1.677,4.399-1.677,4.399c3.26,0.459,5.588,3.392,5.588,6.05c0,2.659-1.118,4.4-1.118,4.4\n			c8.569-3.941,10.898-10.908,12.854-15.4C58.485,30.358,61,26.6,61,26.6C50.755,26.6,45.354,29.9,45.354,29.9z"})],-1),o("g",null,[o("path",{"fill-rule":"evenodd",fill:"#CBAD29",d:"M35.854,47.5c2.234,0,3.818-2.842,2.793-4.4c-1.023-1.558-2.142-3.3-5.588-3.3\n			c-3.446,0-5.588,2.384-5.588,5.5c0,3.117,2.98,7.608,8.941,7.7c0,0-5.402-2.384-3.912-7.7C32.5,45.3,33.617,47.5,35.854,47.5z"})],-1)])])}const pe=k(ne,[["render",ie]]),r=class r{version(){return"v.1.0"}static get(e={}){return l({url:"".concat(r.API,"/cms/get"),method:"GET",params:e,withCredentials:!1})}static post(e={}){return l({url:"".concat(r.API,"/cms/post"),method:"POST",data:e})}static put(e={}){return l({url:"".concat(r.API,"/cms/put"),method:"PUT",data:e})}static patch(e={}){return l({url:"".concat(r.API,"/cms/patch"),method:"PATCH",data:e})}static delete(){return l({url:"".concat(r.API,"/cms/delete?id=1"),method:"Delete"})}};y(r,"API",v.BASE_API),y(r,"upload",e=>l({url:"".concat(r.API,"/cms/delete?id=1"),method:"post",headers:{"Content-type":"multipart/form-data"},data:e}));let A=r;class N extends A{constructor(e){super(e)}static toLogin(e){return l({url:"".concat(v.BASE_API,"/base/user/login"),method:"post",data:e})}static userInfo(){return l({url:"".concat(v.BASE_API,"/base/user/detail"),method:"get"})}static menuList(){return new Promise((e,c)=>{setTimeout(()=>{let d=asyncRoutes;e({code:200,data:d})},300)})}}let ue=()=>l({url:"".concat(v.BASE_API,"/cms/article/tongji"),method:"get"});const de={class:"flex"},me={class:"login-bg pd-20 flex flex-col"},fe={class:"title align-c fw-400 c-fff f-24 mb-20"},ge={class:"login-wrap flex justify-center items-center flex-col flex-1"},we={class:"login flex flex-col justify-center items-center w-full"},ve={class:"w-full overflow-h"},he={class:"f-13 text-c mt-10"},_e={__name:"index",setup(n){const e=te(),c=se(),d=re(),i=M({username:"",password:""}),g=w(!1),C=w(""),P=w(""),S=M({ip:"",country:"",prov:"",city:"",district:"",isp:"",lat:"",lng:""}),L=["/public/cover/sea/01.png","/public/cover/sea/02.png","/public/cover/sea/03.png","/public/cover/sea/04.png","/public/cover/sea/05.png","/public/cover/sea/06.png","/public/cover/sea/07.png"],E=w(null),B=()=>{U()},R=s=>{console.log(s)},V=async()=>{E.value.validate(s=>{if(s)g.value=!0;else return!1})},U=async()=>{try{const{username:s,password:t}=i,p=I.get("_f"),m=I.get("_i"),u=await N.toLogin({username:s,password:t,f:p,i:m});if(u.code==200){const{token:h}=u.data;d.setToken(h),await F()}else u.code===201&&(x({title:"提示",message:u.msg||"登录失败",type:"warning"}),g.value=!1)}catch(s){console.log(s)}},F=async()=>{try{const s=await N.userInfo();if(s.code===200){let t=s.data;if(!(t!=null&&t.role)){x({title:"提示",message:"您没有角色，请联系管理员",duration:3e3,type:"error"}),d.logout(),g.value=!1;return}d.setUserInfo(t),x({title:"提示",message:"登录成功",duration:900,type:"success"}),O(),await ae(),await le(S),e.push(c.query.redirect||"/")}}catch(s){console.log(s)}},O=async()=>{let s=I.get("pos"),t=JSON.parse(s);Object.assign(S,t)};async function q(){try{const s=await ue();if(s.code===200&&s.data){let{APP_VERSION:t,APP_VERSION_TIME:p}=s.data;C.value=t,P.value=p.slice(0,4)}else H({message:s.msg,type:"error"})}catch(s){console.log(s)}}return W(async()=>{await q()}),(s,t)=>{const p=J,m=G,u=Q,h=K;return j(),T(ee,null,[o("div",de,[o("div",me,[o("h1",fe,"ChanCMS v"+$(C.value),1),t[2]||(t[2]=X('<div class="w-full flex sends flex-col justify-center c-fff" data-v-36217139><div class="love pd-20" data-v-36217139><p class="f-16 mb-15" data-v-36217139> ChanCMS基于Node、Express、MySQL、Vue3研发的高质量实用型CMS系统。轻量、灵活、易用、安全。 </p><p class="f-16 mb-15" data-v-36217139> 官网：<a href="https://www.chancms.top" data-v-36217139>www.chancms.top</a></p><p class="f-16 mb-15" data-v-36217139>作者：明空</p></div></div>',1))]),o("div",ge,[o("div",we,[a(pe,{class:"icon"}),t[4]||(t[4]=o("h1",null,"ChanCMS",-1)),a(h,{class:"mt-20 login-form",model:i,ref_key:"formRef",ref:E,"label-width":"70px",onKeyup:Y(V,["enter"])},{default:f(()=>[a(m,{label:"用户名",prop:"username","label-position":"left",rules:[{required:!0,message:"请输入用户名",trigger:"blur"}]},{default:f(()=>[a(p,{modelValue:i.username,"onUpdate:modelValue":t[0]||(t[0]=_=>i.username=_),placeholder:"请输入用户名","prefix-icon":"User"},null,8,["modelValue"])]),_:1}),a(m,{label:"密码",prop:"password","label-position":"left",rules:[{required:!0,message:"请输入密码",trigger:"blur"}]},{default:f(()=>[a(p,{type:"password",modelValue:i.password,"onUpdate:modelValue":t[1]||(t[1]=_=>i.password=_),placeholder:"请输入密码","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1}),a(m,null,{default:f(()=>[a(u,{class:"w-full",type:"primary",size:"large",onClick:V},{default:f(()=>[...t[3]||(t[3]=[b(" 登录 ",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),o("footer",ve,[o("p",he,[b(" Copyright © 2016-"+$(P.value)+" ",1),t[5]||(t[5]=o("a",{href:"https://www.chancms.top",class:"mr-5",target:"_blank",title:"chanyue"},"ChanCMS",-1)),t[6]||(t[6]=b(" ● 位于南京 服务全国 ",-1))])])])]),a(Z(oe),{imgs:L,show:g.value,onSuccess:B,onFail:R},null,8,["show"])],64)}}},ze=k(_e,[["__scopeId","data-v-36217139"]]);export{ze as default};
