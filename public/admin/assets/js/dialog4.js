import{q as U,r as L,s as K,K as F,B as T,C as j,g as O,D as q,a as _}from"./element-plus.js";import{r as g,b as z,V as G,w as J,J as H,o as Q,K as s,U as a,a2 as y,a as W,M as X}from"./@vue.js";import{h as u,A as m,_ as Y,t as Z,a as ee}from"./index.js";let te=(l={})=>u({url:"".concat(m.BASE_API,"/base/menu/list"),method:"get",params:l}),ce=(l={})=>u({url:"".concat(m.BASE_API,"/base/role/list"),method:"get",params:l}),oe=(l={})=>u({url:"".concat(m.BASE_API,"/base/role/create"),method:"post",data:l}),le=(l={})=>u({url:"".concat(m.BASE_API,"/base/role/detail"),method:"get",params:l}),ae=(l={})=>u({url:"".concat(m.BASE_API,"/base/role/update"),method:"post",data:l}),pe=(l={})=>u({url:"".concat(m.BASE_API,"/base/role/delete"),method:"get",params:l}),se=l=>u({url:"".concat(m.BASE_API,"/base/roleMenu/list"),method:"get",params:l});const re={class:"dialog-footer"},ne={__name:"dialog",props:{visible:{type:Boolean,default:!1},id:{type:Number,default:0}},emits:["update:visible","success"],setup(l,{emit:E}){const c=l,b=g(null),v=g(null),i=g([]),p=g(0),I=()=>{const t=v.value.getCheckedKeys();i.value=[...t]},k=E,V=z({get:()=>c.visible,set:t=>k("update:visible",t)}),o=G({menus:[],form:{name:"",key:"",sort:"0",status:"1"}});J(()=>c.visible,async t=>{if(t&&(w(),c.id>0)){const e=Number(c.id);p.value=e,P(e),B(e)}});const w=async()=>{try{const t=await te();if(t.code===200){const e=Z(t.data.list),n=ee(e,"title","id");o.menus=n}}catch(t){console.log(t)}},B=async t=>{try{let e=await se({id:t});if(console.log("res--->",e),e.code==200){let n=e.data.list.map(d=>d.menu_id);i.value=[...n]}}catch(e){console.error(e)}},C=async()=>{try{const t=await oe({roleData:o.form,menuIds:i.value});t.code===200?(_({message:"创建成功 ^_^",type:"success"}),f()):_({message:t.msg,type:"error"})}catch(t){console.log(t)}},M=async()=>{try{let t={roleId:p.value,roleData:o.form,menuIds:i.value};const e=await ae(t);e.code===200?(_({message:"更新成功 ^_^",type:"success"}),f()):_({message:e.msg,type:"error"})}catch(t){console.log(t)}},P=async t=>{try{let e=await le({id:t});e.code==200&&(o.form=e.data)}catch(e){console.error(e)}},S=t=>{t&&t.validate(e=>{if(e)p.value==0?C():M();else return console.log("error submit!!"),!1})},f=()=>{k("update:visible",!1),x()},x=()=>{o.form={name:"",key:"",sort:"0",status:"1"},o.menus=[],p.value=0,i.value=[]};return(t,e)=>{const n=K,d=L,D=F,h=j,$=T,N=U,A=O,R=q;return Q(),H(R,{modelValue:V.value,"onUpdate:modelValue":e[5]||(e[5]=r=>V.value=r),title:"编辑",onClose:f},{footer:s(()=>[W("span",re,[a(A,{onClick:X(f,["stop"])},{default:s(()=>[...e[8]||(e[8]=[y("取消",-1)])]),_:1}),a(A,{type:"primary",onClick:e[4]||(e[4]=r=>S(b.value))},{default:s(()=>[...e[9]||(e[9]=[y("确定",-1)])]),_:1})])]),default:s(()=>[a(N,{model:o.form,ref_key:"formRef",ref:b,"label-width":"84px"},{default:s(()=>[a(d,{label:"角色名称",prop:"name"},{default:s(()=>[a(n,{modelValue:o.form.name,"onUpdate:modelValue":e[0]||(e[0]=r=>o.form.name=r),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),a(d,{label:"角色标识",prop:"key"},{default:s(()=>[a(n,{modelValue:o.form.key,"onUpdate:modelValue":e[1]||(e[1]=r=>o.form.key=r),placeholder:"请输入角色标识"},null,8,["modelValue"])]),_:1}),a(d,{label:"角色顺序",prop:"sort"},{default:s(()=>[a(n,{modelValue:o.form.sort,"onUpdate:modelValue":e[2]||(e[2]=r=>o.form.sort=r),type:"number",placeholder:"请输入角色顺序"},null,8,["modelValue"])]),_:1}),a(d,{label:"权限菜单",prop:"pid"},{default:s(()=>[a(D,{onCheck:I,data:o.menus,"default-checked-keys":i.value,multiple:"",ref_key:"treeRef",ref:v,"render-after-expand":!1,"show-checkbox":"","check-on-click-node":"","show-count":!0,"node-key":"id",class:"w-full"},null,8,["data","default-checked-keys"])]),_:1}),a(d,{label:"状态"},{default:s(()=>[a($,{modelValue:o.form.status,"onUpdate:modelValue":e[3]||(e[3]=r=>o.form.status=r)},{default:s(()=>[a(h,{label:"显示",value:"1"},{default:s(()=>[...e[6]||(e[6]=[y("正常",-1)])]),_:1}),a(h,{label:"隐藏",value:"2"},{default:s(()=>[...e[7]||(e[7]=[y("停用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}},de=Y(ne,[["__scopeId","data-v-557d46a3"]]),fe=Object.freeze(Object.defineProperty({__proto__:null,default:de},Symbol.toStringTag,{value:"Module"}));export{de as D,fe as d,ce as l,pe as r};
