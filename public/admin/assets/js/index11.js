import{g as V,u as j,v as F,x as H,y as J,a as _}from"./element-plus.js";import{u as q}from"./vue-router.js";import{H as z,F as G,J as K}from"./@element-plus.js";import{l as E,b as L,a as O}from"./collect.js";import{c as Q}from"./article.js";import{f as W}from"./index.js";import{r as d,V as X,n as Y,ai as Z,aq as tt,c as et,o as h,U as a,K as n,R as g,J as A,a2 as m,O as b,u as w}from"./@vue.js";import"./dayjs.js";import"./ace-builds.js";import"./lodash-es.js";import"./@popperjs.js";import"./async-validator.js";import"./@ctrl.js";import"./memoize-one.js";import"./normalize-wheel-es.js";import"./pinia.js";import"./pinia-plugin-persist.js";import"./axios.js";import"./js-cookie.js";import"./nprogress.js";import"./@fingerprintjs.js";import"./tslib.js";/* empty css     */const at={class:"bg-fff radius-6 pd-20"},Et={__name:"index",setup(ot){const S=q(),B=d(null),C=d([]),$=d([]),k=d(0),x=d(1),l=d(0),i=X({cid:0,title:"",shortTitle:"",tagId:"",attr:[],source:"",author:"",description:"",img:"",createdAt:new Date,updatedAt:new Date,content:"欢迎使用ChanCMS系统",status:"0",pv:1,link:""}),T=async()=>{try{const e=await E(x.value);e.code===200&&(C.value=[...e.data.list],k.value=e.data.count)}catch(e){console.log(e)}},R=e=>{x.value=e,E()},I=e=>{$.value=e},D=async e=>{try{const{pages:t,titleTag:o,articleTag:u,parseData:c,charset:s,cid:y,status:v}=e,p=t.split(","),r=await O({taskUrl:p[l.value],titleTag:o,articleTag:u,parseData:c,charset:s});if(r.code===200){const{title:f,article:U}=r.data;i.title=f,i.content=U,i.cid=y,i.status=v===1?1:0,M(i)}}catch(t){console.log(t)}},M=async e=>{try{const t={...i};t.attr=t.attr.toString(),t.tagId=t.tagId.toString(),!t.description&&t.content&&(t.description=W(t.content).substr(0,255));const o=await Q({defaultParams:t,fieldParams:{}});o.code===200?(_({message:"第".concat(l.value+1,"条数据完成^_^"),type:"success"}),setTimeout(()=>{const{pages:u}=e,c=u.split(",");l.value<=c.length-1&&(D(e),l.value=l.value+1)},3e3)):_({message:o.msg||"第".concat(l.value+1,"条数据失败^_^"),type:"error"})}catch(t){console.log(t)}},N=e=>{const t=e.id;S.push({name:"collect-edit",params:{id:t}})},P=async e=>{const t=e.id;try{const o=await L(t);o.code===200?(_({message:"删除成功 ^_^",type:"success"}),T()):_({message:o.msg,type:"error"})}catch(o){console.log(o)}};return Y(()=>{T()}),(e,t)=>{const o=V,u=Z("router-link"),c=j,s=F,y=H,v=J,p=tt("permission-disabled");return h(),et("div",at,[a(c,{type:"flex",justify:"end"},{default:n(()=>[g((h(),A(u,{to:"/collect/add"},{default:n(()=>[a(o,{type:"primary",round:""},{default:n(()=>[...t[0]||(t[0]=[m("新增",-1)])]),_:1})]),_:1})),[[p,["editor","admin","super"]]])]),_:1}),a(y,{ref_key:"multipleTable",ref:B,data:C.value,"tooltip-effect":"dark","row-key":"id",onSelectionChange:I},{default:n(()=>[a(s,{type:"selection"}),a(s,{prop:"id",width:"60",label:"编号"}),a(s,{prop:"taskName",label:"任务名称"}),a(s,{prop:"category",label:"所属栏目"}),a(s,{prop:"charset",label:"编码"},{default:n(r=>[m(b(r.row.charset===1?"UTF-8":"GB2312"),1)]),_:1}),a(s,{prop:"status",label:"状态"},{default:n(r=>[m(b(r.row.status===1?"草稿":"发布"),1)]),_:1}),a(s,{prop:"updatedAt",label:"发布时间"},{default:n(r=>[m(b(r.row.updatedAt),1)]),_:1}),a(s,{fixed:"right",width:"222",label:"操作"},{default:n(r=>[g(a(o,{icon:w(z),circle:"",onClick:f=>N(r.row)},null,8,["icon","onClick"]),[[p,["editor","admin","super"]]]),g(a(o,{icon:w(G),circle:"",onClick:f=>P(r.row)},null,8,["icon","onClick"]),[[p,["editor","admin","super"]]]),g((h(),A(o,{type:"primary",round:"",icon:w(K),onClick:f=>D(r.row)},{default:n(()=>[...t[1]||(t[1]=[m("执行",-1)])]),_:1},8,["icon","onClick"])),[[p,["editor","admin","super"]]])]),_:1})]),_:1},8,["data"]),a(c,{type:"flex",class:"mt-20 align-c",justify:"center"},{default:n(()=>[a(v,{background:"",layout:"prev, pager, next",onCurrentChange:R,"page-size":10,total:k.value,"hide-on-single-page":""},null,8,["total"])]),_:1})])}}};export{Et as default};
